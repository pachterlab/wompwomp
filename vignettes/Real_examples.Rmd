---
title: "Introduction to alluvialmatch"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to alluvialmatch}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
devtools::load_all()
# library(alluvialmatch)
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(ggforce)
library(igraph)
library(tibble)
library(tidyr)
library(reticulate)

alluvialmatch::setup_python_env()  #!!! erase
```

Set up our python environment
```{r setup-env, eval = FALSE}
alluvialmatch::setup_python_env()
```

```{r check-python, include = FALSE}
if (!reticulate::py_module_available("splitspy")) {
    message("‚ùå 'splitspy' not found. Run alluvialmatch::setup_python_env() and restart R.")
    knitr::knit_exit()
}
```

```{r}
data_path <- "/Users/joeyrich/Desktop/local/alluvialmatch/tmp_files/kits_alluvial_data.csv"
df <- read.csv(data_path)

df$KiTS_dice_score_binned_broad <- cut(
  df$KiTS_dice_score,
  breaks = c(-Inf, 0.2, 0.7, 1),
  labels = c("0-0.2", "0.2-0.7", "0.7-1"),
  right = FALSE  # means intervals are [a, b)
)

df$USC_dice_score_binned_broad <- cut(
  df$USC_dice_score,
  breaks = c(-Inf, 0.2, 0.7, 1),
  labels = c("0-0.2", "0.2-0.7", "0.7-1"),
  right = FALSE  # means intervals are [a, b)
)
```

```{r}
graphing_columns <- c("KiTS_dice_score_binned", "USC_dice_score_binned")
df_tmp <- df[graphing_columns]
plot_alluvial(df_tmp, graphing_columns = graphing_columns, sorting_algorithm = "None", color_bands=TRUE, verbose=TRUE)
# plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "neighbornet", color_bands=TRUE)  #!!!! uncomment
```

```{r}
devtools::load_all()
plot_alluvial(df_tmp, graphing_columns = graphing_columns, sorting_algorithm = "neighbornet", color_bands=TRUE, verbose=TRUE, optimize_column_order_per_cycle=FALSE)
```

```{r}
devtools::load_all()
# debugonce(plot_alluvial)
plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "neighbornet", color_bands=TRUE, verbose=TRUE)
```

WOLF
```{r}
devtools::load_all()
plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "greedy_WOLF", fixed_column = "KiTS_dice_score_binned", color_bands=TRUE, verbose=TRUE, random_initializations=3)
plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "greedy_WBLF", color_bands=TRUE, verbose=TRUE, random_initializations = 3)
```



```{r}
graphing_columns <- c("gender", "Race", "radiographic_size_binned", "KiTS_dice_score_binned_broad")
plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "None", color_bands=TRUE)
# plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "neighbornet", color_bands=TRUE)

graphing_columns <- c("gender", "Race", "radiographic_size_binned", "USC_dice_score_binned_broad")
plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "None", color_bands=TRUE)
# plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "neighbornet", color_bands=TRUE)
```

```{r}
graphing_columns <- c("gender", "Race", "radiographic_size_binned", "USC_dice_score_binned")
plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "None", color_bands=TRUE)
plot_alluvial(df, graphing_columns = graphing_columns, sorting_algorithm = "neighbornet", color_bands=TRUE)
```

```{r}
sessioninfo::session_info()
```



GOT
```{r}
url <- "https://raw.githubusercontent.com/MattLunkes/GoT_Affiliations/master/got_char.csv"
got_file <- "got_char.csv"
graphing_columns <- c("Origin", "Starting.Affiliation", "End.of.S1", "End.of.S2", "End.of.S3", "End.of.S4", "End.of.S5", "End.of.S6", "End.of.S7")

if (!file.exists(got_file)) {
    download.file(got_file, destfile, method = "curl")
}

df <- read.csv(got_file)
```

```{r}
df_tmp <- df[graphing_columns]
plot_alluvial(df_tmp, graphing_columns = graphing_columns, sorting_algorithm = "None", color_bands=TRUE, verbose=TRUE)
```

```{r}
plot_alluvial(df_tmp, graphing_columns = graphing_columns, sorting_algorithm = "neighbornet", optimize_column_order=FALSE, color_bands=TRUE, verbose=TRUE)
```





